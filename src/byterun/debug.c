/******************************************************************************/
/******************************************************************************/
/******************************************************************************/

#include "debug.h"
#include "values.h"
#include "gc.h"

#ifdef __PC__
#include <stdio.h>
#endif

/******************************************************************************/
/******************************************************************************/
/******************************************************************************/

#ifdef __PC__

void print_heap() {
  val_t *ptr;
  int i = 0;

  printf("HEAP (starts at %p, ends at %p, size = %d words) : \n", ocaml_heap, ocaml_heap + OCAML_HEAP_WOSIZE, OCAML_HEAP_WOSIZE);

  for(ptr = ocaml_heap; ptr < ocaml_heap + OCAML_HEAP_WOSIZE; ptr ++){
    float f = *((float *) ptr);
#ifdef OCAML_GC_STOP_AND_COPY
    if (ptr == ocaml_heap + OCAML_HEAP_WOSIZE / 2) {
      printf("======================================================\n");
    }
#endif
    if (Is_int(*ptr)){
      printf("%d  @%p : 0x%08x (int = %d / float = %f)", i, ptr, *ptr, Int_val(*ptr), f);
    } else if (Is_block(*ptr)) {
      printf("%d  @%p : 0x%08x / @(%p)",i, ptr, *ptr, Block_val(*ptr));
    } else if (*ptr == 0) {
      printf("%d  @%p : _",i, ptr);
    } else {
      printf("%d  @%p : 0x%08x (maybe %f)", i, ptr, *ptr, f);
    }
    printf("\n");
    i ++;
  }
  printf("heap_ptr = %p", heap_ptr);
  printf("\n\n\n");
}

#endif

/******************************************************************************/
/******************************************************************************/
/******************************************************************************/

#ifdef __AVR__

void print_heap(void) {
}

#endif

/******************************************************************************/
/******************************************************************************/
/******************************************************************************/

